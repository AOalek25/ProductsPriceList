@page "/deleteinputdialog"
@using ProductLibrary
@using ProductLibrary.Model
@using ProductLibrary.Exceptions
@using ExcelService

@inject ProductRepo repo
@inject NavigationManager NavigationManager
@inject IJSRuntime JS

<h3>Введите данные для удаления.</h3>

<div class="row">
  <div class="col">
    <input class="form-control" placeholder="Введите наименование" @bind="_name" required minlength="2"></input>
  </div>
  <div class="col">
    <input class="form-control" placeholder="Введите производителя" @bind="_manufacturerId" ></input>
  </div>  
</div>

<button class="btn btn-primary" @onclick="Delete">Удалить</button>
<a href="pricelist" class="btn btn-primary">Назад</a>

@code {  
  private string _name = "";  
  private int _manufacturerId = 0;
  private ExcelService _excelService = new(ExcelServiceConstants.BlazorData);

  internal async Task Delete()
  {   
    try
    {
      repo.Delete(_name, _manufacturerId);
      await _excelService.SaveToFileAsync(repo.GetAll(), ExcelServiceConstants.BlazorData, ExcelServiceConstants.PriceListFileName);
    }
    catch (InvalidOperationException ex)
    {
      await JS.InvokeVoidAsync("alert", ex.Message);
    }
    catch (ProductNotFoundException ex)
    { 
      await JS.InvokeVoidAsync("alert", ex.Message);
    }
    this.NavigationManager.NavigateTo("/pricelist", true);
  }
}
